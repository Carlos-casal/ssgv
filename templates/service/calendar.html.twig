{% extends 'layout/app.html.twig' %}

{% block title %}Calendario de Servicios{% endblock %}

{% block content %}
<div class="p-6">
    <div id="calendar"></div>
    <div id="service-list-container" class="mt-4">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Servicios del día</h3>
        <ul id="serviceList" class="list-disc list-inside">
        </ul>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'es',
                events: '/api/services',
                eventClassNames: 'service-event',
                eventDisplay: 'block',
                firstDay: 1,
                showNonCurrentDates: false,
                dateClick: function(info) {
                    fetch('/api/services?start=' + info.dateStr + '&end=' + info.dateStr)
                        .then(response => response.json())
                        .then(data => {
                            var serviceList = document.getElementById('serviceList');
                            serviceList.innerHTML = '';
                            if (data.length > 0) {
                                data.forEach(service => {
                                    var li = document.createElement('li');
                                    var a = document.createElement('a');
                                    a.href = service.url;
                                    a.textContent = service.title;
                                    li.appendChild(a);
                                    serviceList.appendChild(li);
                                });
                            } else {
                                var li = document.createElement('li');
                                li.textContent = 'No hay servicios para este día.';
                                serviceList.appendChild(li);
                            }
                        });
                }
            });
            calendar.render();
        });
    </script>
{% endblock %}
