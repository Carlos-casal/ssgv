{% extends 'layout/app.html.twig' %}

{% block title %}Alta Voluntari@ - PC Vigo{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .form-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .form-grid {
            display: grid;
            gap: 1.5rem;
        }
        .is-invalid { border-color: #dc3545 !important; }
        .invalid-feedback { color: #dc3545; font-size: 0.875em; margin-top: 0.25rem; }
        .is-valid { border-color: #28a745 !important; }
        .validation-icon { position: absolute; right: 0.75rem; top: 70%; transform: translateY(-50%); }
    </style>
{% endblock %}

{% block content %}
<div class="p-6 space-y-6"
    data-controller="form-validation age-modal dependent-fields"
    data-dependent-fields-url-value="/api/poblaciones">

    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        <div>
            <h2 class="text-2xl font-bold text-gray-900">Alta Voluntari@</h2>
            <p class="text-gray-600">Rellena el formulario para dar de alta a un nuevo voluntario en el sistema.</p>
        </div>
    </div>

    {{ form_start(form, {'attr': {'novalidate': 'novalidate', 'data-action': 'submit->form-validation#handleSubmit'}}) }}
        {{ form_errors(form) }}

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Datos Personales</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    {{ form_label(form.dni) }}
                    {{ form_widget(form.dni) }}
                    {{ form_errors(form.dni) }}
                </div>
                <div>
                    {{ form_label(form.name) }}
                    {{ form_widget(form.name) }}
                    {{ form_errors(form.name) }}
                </div>
                <div class="md:col-span-2">
                    {{ form_label(form.lastName) }}
                    {{ form_widget(form.lastName) }}
                    {{ form_errors(form.lastName) }}
                </div>
                <div>
                    {{ form_label(form.dateOfBirth) }}
                    {{ form_widget(form.dateOfBirth, {'attr': {'data-action': 'change->age-modal#open', 'data-age-modal-target': 'dateOfBirthInput'}}) }}
                    {{ form_errors(form.dateOfBirth) }}
                </div>
                <div>
                    {{ form_label(form.phone) }}
                    {{ form_widget(form.phone, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                    {{ form_errors(form.phone) }}
                </div>
                {% if form.user.email is defined %}
                <div>
                    {{ form_label(form.user.email) }}
                    {{ form_widget(form.user.email, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                    {{ form_errors(form.user.email) }}
                </div>
                {% endif %}
            </div>
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Foto de Perfil</h2>
            {{ form_row(form.profilePicture) }}
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Información de Salud</h2>
            <div class="grid grid-cols-1 gap-6">
                <div>
                    {{ form_label(form.foodAllergies) }}
                    {{ form_widget(form.foodAllergies) }}
                    {{ form_errors(form.foodAllergies) }}
                </div>
                <div>
                    {{ form_label(form.otherAllergies) }}
                    {{ form_widget(form.otherAllergies) }}
                    {{ form_errors(form.otherAllergies) }}
                </div>
            </div>
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Contacto de Emergencia</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    {{ form_label(form.contactPerson1) }}
                    {{ form_widget(form.contactPerson1, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                    {{ form_errors(form.contactPerson1) }}
                </div>
                <div>
                    {{ form_label(form.contactPhone1) }}
                    {{ form_widget(form.contactPhone1, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                    {{ form_errors(form.contactPhone1) }}
                </div>
                <div>
                    {{ form_label(form.contactPerson2) }}
                    {{ form_widget(form.contactPerson2) }}
                    {{ form_errors(form.contactPerson2) }}
                </div>
                <div>
                    {{ form_label(form.contactPhone2) }}
                    {{ form_widget(form.contactPhone2) }}
                    {{ form_errors(form.contactPhone2) }}
                </div>
            </div>
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Dirección</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-1">
                    {{ form_label(form.streetType) }}
                    {{ form_widget(form.streetType, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                    {{ form_errors(form.streetType) }}
                </div>
                <div class="md:col-span-2">
                    {{ form_label(form.address) }}
                    {{ form_widget(form.address, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                    {{ form_errors(form.address) }}
                </div>
                <div class="md:col-span-1">
                    {{ form_label(form.postalCode) }}
                    {{ form_widget(form.postalCode, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                    {{ form_errors(form.postalCode) }}
                </div>
                <div class="md:col-span-1" data-dependent-fields-target="province">
                    {{ form_label(form.province) }}
                    {{ form_widget(form.province, {'attr': {'data-action': 'change->dependent-fields#loadCities'}}) }}
                    {{ form_errors(form.province) }}
                </div>
                <div class="md:col-span-1" data-dependent-fields-target="city">
                    {{ form_label(form.city) }}
                    {{ form_widget(form.city) }}
                    {{ form_errors(form.city) }}
                </div>
            </div>
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Cualificaciones</h2>
            <div class="mb-4">
                <h3 class="font-medium text-gray-600 mb-2">Permisos de Conducción</h3>
                <div data-form-validation-target="drivingLicenseContainer">
                    {{ form_widget(form.drivingLicenses, {'attr': {'data-action': 'change->form-validation#toggleDrivingLicenseDate'}}) }}
                    {{ form_errors(form.drivingLicenses) }}
                </div>
            </div>
             <div class="mb-4 hidden" data-form-validation-target="drivingLicenseDate">
                {{ form_label(form.drivingLicenseExpiryDate) }}
                {{ form_widget(form.drivingLicenseExpiryDate) }}
                {{ form_errors(form.drivingLicenseExpiryDate) }}
             </div>
            <div class="mb-4">
                <h3 class="font-medium text-gray-600 mb-2">Permisos de Navegación</h3>
                {{ form_widget(form.navigationLicenses) }}
                {{ form_errors(form.navigationLicenses) }}
            </div>
            <div class="mb-4">
                <h3 class="font-medium text-gray-600 mb-2">Titulaciones Específicas</h3>
                {{ form_widget(form.specificQualifications) }}
                {{ form_errors(form.specificQualifications) }}
            </div>
            <div>
                {{ form_label(form.profession) }}
                {{ form_widget(form.profession, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                {{ form_errors(form.profession) }}
            </div>
            <div>
                {{ form_label(form.otherQualifications) }}
                {{ form_widget(form.otherQualifications) }}
                {{ form_errors(form.otherQualifications) }}
            </div>
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Motivación e Intereses</h2>
            <div>
                {{ form_label(form.motivation) }}
                {{ form_widget(form.motivation, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                {{ form_errors(form.motivation) }}
            </div>
            <div>
                {{ form_label(form.howKnown) }}
                {{ form_widget(form.howKnown, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                {{ form_errors(form.howKnown) }}
            </div>
            <div class="mt-4">
                <h3 class="font-medium text-gray-600 mb-2">¿Has sido voluntario antes?</h3>
                {{ form_widget(form.hasVolunteeredBefore, {'attr': {'data-action': 'change->form-validation#togglePreviousVolunteering'}}) }}
                {{ form_errors(form.hasVolunteeredBefore) }}
            </div>
            <div class="hidden mt-4" data-form-validation-target="previousVolunteeringInstitutions">
                {{ form_label(form.previousVolunteeringInstitutions) }}
                {{ form_widget(form.previousVolunteeringInstitutions) }}
                {{ form_errors(form.previousVolunteeringInstitutions) }}
            </div>
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Contraseña de Acceso</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% if form.user.password.first is defined %}
                <div>
                    {{ form_label(form.user.password.first) }}
                    {{ form_widget(form.user.password.first, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                    {{ form_errors(form.user.password.first) }}
                </div>
                {% endif %}
                {% if form.user.password.second is defined %}
                <div>
                    {{ form_label(form.user.password.second) }}
                    {{ form_widget(form.user.password.second, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                    {{ form_errors(form.user.password.second) }}
                </div>
                {% endif %}
            </div>
        </div>

        <div class="flex justify-end mt-4">
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg">Dar de Alta</button>
        </div>
    {{ form_end(form) }}

    <div data-age-modal-target="modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Confirmación de Edad</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500">
                        La edad del voluntario es de <strong data-age-modal-target="age"></strong> años.
                    </p>
                    <p class="text-sm text-red-500 mt-2 age-info">Al ser menor de edad, necesitarás presentar una autorización de tu tutor legal.</p>
                </div>
                <div class="items-center px-4 py-3">
                    <button type="button" data-action="click->age-modal#close" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}