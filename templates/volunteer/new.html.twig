{% extends 'layout/app.html.twig' %}

{% block title %}Alta Voluntari@ - PC Vigo{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .form-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .form-grid {
            display: grid;
            gap: 1.5rem;
        }
        .is-invalid { border-color: #dc3545 !important; }
        .invalid-feedback { color: #dc3545; font-size: 0.875em; margin-top: 0.25rem; }
        .is-valid { border-color: #28a745 !important; }
        .validation-icon { position: absolute; right: 0.75rem; top: 70%; transform: translateY(-50%); }
    </style>
{% endblock %}

{% block content %}
<div class="w-full px-6 py-8"
    data-controller="form-validation age-modal dependent-fields"
    data-dependent-fields-url-value="/api/poblaciones">

    <h1 class="text-2xl font-bold mb-8">Alta Voluntari@</h1>

    {{ form_start(form, {'attr': {'novalidate': 'novalidate', 'data-action': 'submit->form-validation#handleSubmit'}}) }}
        {{ form_errors(form) }}

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Datos Personales</h2>
            <div class="grid grid-cols-1 md:grid-cols-6 gap-6">
                <div class="md:col-span-1">{{ form_row(form.dni) }}</div>
                <div class="md:col-span-2">{{ form_row(form.name) }}</div>
                <div class="md:col-span-3">{{ form_row(form.lastName) }}</div>
                <div class="md:col-span-2">{{ form_row(form.dateOfBirth, {'attr': {'data-action': 'change->age-modal#open', 'data-age-modal-target': 'dateOfBirthInput'}}) }}</div>
                <div class="md:col-span-2">{{ form_row(form.phone, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}</div>
                {% if form.user.email is defined %}<div class="md:col-span-2">{{ form_row(form.user.email, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}</div>{% endif %}
            </div>
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Foto de Perfil</h2>
            {{ form_row(form.profilePicture) }}
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Información de Salud</h2>
            <div class="form-grid">
                {{ form_row(form.foodAllergies) }}
                {{ form_row(form.otherAllergies) }}
            </div>
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Contacto de Emergencia</h2>
            <div class="form-grid">
                {{ form_row(form.contactPerson1, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                {{ form_row(form.contactPhone1, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
                {{ form_row(form.contactPerson2) }}
                {{ form_row(form.contactPhone2) }}
            </div>
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Dirección</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-1">{{ form_row(form.streetType, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}</div>
                <div class="md:col-span-2">{{ form_row(form.address, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}</div>
                <div class="md:col-span-1">{{ form_row(form.postalCode, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}</div>
                <div class="md:col-span-1" data-dependent-fields-target="province">{{ form_row(form.province, {'attr': {'data-action': 'change->dependent-fields#loadCities'}}) }}</div>
                <div class="md:col-span-1" data-dependent-fields-target="city">{{ form_row(form.city) }}</div>
            </div>
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Cualificaciones</h2>
            <div class="mb-4">
                <h3 class="font-medium text-gray-600 mb-2">Permisos de Conducción</h3>
                <div data-form-validation-target="drivingLicenseContainer">{{ form_widget(form.drivingLicenses, {'attr': {'data-action': 'change->form-validation#toggleDrivingLicenseDate'}}) }}</div>
            </div>
             <div class="mb-4 hidden" data-form-validation-target="drivingLicenseDate">{{ form_row(form.drivingLicenseExpiryDate) }}</div>
            <div class="mb-4">
                <h3 class="font-medium text-gray-600 mb-2">Permisos de Navegación</h3>
                {{ form_widget(form.navigationLicenses) }}
            </div>
            <div class="mb-4">
                <h3 class="font-medium text-gray-600 mb-2">Titulaciones Específicas</h3>
                {{ form_widget(form.specificQualifications) }}
            </div>
            {{ form_row(form.profession, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
            {{ form_row(form.otherQualifications) }}
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Motivación e Intereses</h2>
            {{ form_row(form.motivation, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
            {{ form_row(form.howKnown, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}
            <div class="mt-4">
                <h3 class="font-medium text-gray-600 mb-2">¿Has sido voluntario antes?</h3>
                {{ form_widget(form.hasVolunteeredBefore, {'attr': {'data-action': 'change->form-validation#togglePreviousVolunteering'}}) }}
            </div>
            <div class="hidden mt-4" data-form-validation-target="previousVolunteeringInstitutions">{{ form_row(form.previousVolunteeringInstitutions) }}</div>
        </div>

        <div class="form-card">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Contraseña de Acceso</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% if form.user.password.first is defined %}{{ form_row(form.user.password.first, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}{% endif %}
                {% if form.user.password.second is defined %}{{ form_row(form.user.password.second, {'attr': {'data-action': 'blur->form-validation#validateField'}}) }}{% endif %}
            </div>
        </div>

        <div class="flex justify-end mt-4">
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg">Dar de Alta</button>
        </div>
    {{ form_end(form) }}

    <div data-age-modal-target="modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Confirmación de Edad</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500">
                        La edad del voluntario es de <strong data-age-modal-target="age"></strong> años.
                    </p>
                    <p class="text-sm text-red-500 mt-2 age-info">Al ser menor de edad, necesitarás presentar una autorización de tu tutor legal.</p>
                </div>
                <div class="items-center px-4 py-3">
                    <button type="button" data-action="click->age-modal#close" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}