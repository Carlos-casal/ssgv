{% extends 'layout/app.html.twig' %}

{% block page_title %}Crear Nuevo Voluntario{% endblock %}

{% block content %}
<div class="container mx-auto p-6">
    <h1 class="text-2xl font-bold mb-6 text-gray-900">
        Crear Nuevo Voluntario
    </h1>

    {{ form_start(form, {'attr': {'class': 'bg-white p-6 rounded-lg shadow-md'}, 'enctype': 'multipart/form-data'}) }}

    <div class="flex flex-col md:flex-row gap-6 mb-8">
        <div class="w-full md:w-1/2 p-4 border border-gray-200 rounded-lg text-center bg-gray-50">
            <h3 class="text-xl font-semibold mb-4 text-gray-800">Foto de Perfil</h3>
            <div class="mb-4">
                <div id="preview-element" class="w-32 h-32 rounded-full mx-auto bg-gray-300 flex items-center justify-center text-gray-600 text-sm mb-4 border-2 border-blue-300 shadow">
                    Sin Foto
                </div>
            </div>
            <div class="w-fit mx-auto">
                {{ form_row(form.profilePicture, {
                    label: 'Subir foto',
                    attr: {
                        'class': 'block text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none'
                    }
                }) }}
            </div>
            <p class="text-xs text-gray-500 mt-1">Sube una imagen JPG o PNG (máx. 1MB).</p>
        </div>

        <div class="w-full md:w-1/2 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <h3 class="text-xl font-semibold mb-4 text-gray-800">Datos Básicos</h3>
            <div class="grid grid-cols-2 gap-x-6">
                <div class="col-span-1">
                    {{ form_row(form.name) }}
                </div>
                <div class="col-span-1">
                    {{ form_row(form.lastName) }}
                </div>
                <div class="col-span-1 mt-4">
                    {{ form_row(form.phone) }}
                </div>
                <div class="col-span-1 mt-4">
                    {{ form_row(form.user.email) }}
                </div>
                <div class="col-span-1 mt-4">
                    {{ form_row(form.dni) }}
                </div>
                <div class="col-span-1 mt-4">
                    {{ form_row(form.dateOfBirth) }}
                </div>
            </div>
        </div>
    </div>

    <div class="w-full p-4 border border-gray-200 rounded-lg bg-white mb-8">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">Datos Detallados del Voluntario</h3>

        <h2 class="text-lg font-semibold mt-6 mb-4 text-gray-800 border-b pb-2">Dirección</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>{{ form_row(form.streetType) }}</div>
            <div>{{ form_row(form.address) }}</div>
            <div>{{ form_row(form.postalCode) }}</div>
            <div>{{ form_row(form.province) }}</div>
            <div>{{ form_row(form.city) }}</div>
        </div>

        <h2 class="text-lg font-semibold mt-6 mb-4 text-gray-800 border-b pb-2">Información de Emergencia</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>{{ form_row(form.contactPerson1) }}</div>
            <div>{{ form_row(form.contactPhone1) }}</div>
            <div>{{ form_row(form.contactPerson2) }}</div>
            <div>{{ form_row(form.contactPhone2) }}</div>
        </div>

        <h2 class="text-lg font-semibold mt-6 mb-4 text-gray-800 border-b pb-2">Información Médica</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>{{ form_row(form.allergies) }}</div>
        </div>

        <h2 class="text-lg font-semibold mt-6 mb-4 text-gray-800 border-b pb-2">Profesional y Cualificaciones</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>{{ form_row(form.profession) }}</div>
            <div>{{ form_row(form.employmentStatus) }}</div>
            <div>{{ form_row(form.drivingLicenses) }}</div>
            <div>{{ form_row(form.drivingLicenseExpiryDate) }}</div>
        </div>
        <div class="mb-4">{{ form_row(form.navigationLicenses) }}</div>
        <div class="mb-4">{{ form_row(form.specificQualifications) }}</div>
        <div class="mb-4">{{ form_row(form.otherQualifications) }}</div>

        <h2 class="text-lg font-semibold mt-6 mb-4 text-gray-800 border-b pb-2">Otros Datos e Intereses</h2>
        <div class="mb-4">{{ form_row(form.languages) }}</div>
        <div class="mb-4">{{ form_row(form.motivation) }}</div>
        <div class="mb-4">{{ form_row(form.howKnown) }}</div>
        <div class="mb-4">{{ form_row(form.hasVolunteeredBefore) }}</div>
        <div class="mb-4">{{ form_row(form.previousVolunteeringInstitutions) }}</div>

        <h2 class="text-lg font-semibold mt-6 mb-4 text-gray-800 border-b pb-2">Rol y Especialización</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>{{ form_row(form.role) }}</div>
            <div>{{ form_row(form.specialization) }}</div>
        </div>

        <h2 class="text-lg font-semibold mt-6 mb-4 text-gray-800 border-b pb-2">Contraseña</h2>
        <div class="mb-4">{{ form_row(form.user.password) }}</div>
    </div>

    <div class="flex items-center justify-end gap-3 mt-6">
        <a href="{{ path('app_volunteer_list') }}" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition-colors">Cancelar</a>
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Crear Voluntario</button>
    </div>

    {{ form_end(form) }}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const profilePictureInput = document.querySelector('input[type="file"][name$="[profilePicture]"]');
        let previewElement = document.getElementById('preview-element');

        if (profilePictureInput && previewElement) {
            profilePictureInput.addEventListener('change', function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        if (previewElement.tagName === 'DIV') {
                            const newImg = document.createElement('img');
                            newImg.id = 'preview-element';
                            newImg.alt = 'Foto de perfil';
                            newImg.className = 'w-32 h-32 rounded-full object-cover mx-auto border-2 border-blue-300 shadow mb-4';
                            previewElement.parentNode.replaceChild(newImg, previewElement);
                            previewElement = newImg;
                        }
                        previewElement.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
    });
</script>
{% endblock %}